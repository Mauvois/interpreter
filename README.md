
# IChing Interpreter Microservice

## Overview

The IChing Interpreter is a microservice built with FastAPI that serves as the interpretation engine for the IChing web application. It connects to OpenAI's ChatGPT via Langchain to provide modern and contextual interpretations of hexagrams generated by the IChing app. This microservice takes the generated hexagram and the user's question, processes them, and returns a detailed interpretation that blends ancient wisdom with contemporary insights.

## Features

- **Hexagram Interpretation**: Receives hexagram data along with a user question and uses ChatGPT to generate a nuanced interpretation.
- **API-Based Architecture**: Exposes RESTful endpoints for easy integration with other services and applications.
- **Scalability**: Can be deployed as a standalone microservice and scaled independently based on traffic and demand.
- **Language Processing**: Leverages the power of Langchain to process natural language input and generate context-aware responses.

## Architecture

- **Backend**: Built using FastAPI, a modern, fast web framework for building APIs with Python.
- **Integration with Langchain**: Utilizes Langchain to interface with OpenAI's ChatGPT, providing the capability to interpret hexagrams in a meaningful way.
- **Database**: DuckDB is used to store configuration and runtime data if necessary.

## Installation

### Prerequisites

- Python 3.8 or higher
- Docker (optional, for containerized deployment)
- Access to OpenAI's API key for ChatGPT

### Steps

1. **Clone the Repository**:
    ```bash
    git clone https://github.com/yourusername/interpreter.git
    cd interpreter
    ```

2. **Install Dependencies**:
    ```bash
    pip install -r requirements.txt
    ```

3. **Set Environment Variables**:
    Define the following environment variables required for connecting to the necessary services:

    - `OPENAI_API_KEY`: Your OpenAI API key for accessing ChatGPT.
    - `DATABASE_URL`: (Optional) URL to connect to DuckDB for storing runtime data.

4. **Run the Microservice**:
    ```bash
    uvicorn main:app --reload
    ```
    The service will start on `http://127.0.0.1:8000` by default.

## Usage

### API Endpoints

- **Interpret Hexagram**: `POST /interpret`
  
  This endpoint accepts a JSON payload containing the user's question and the generated hexagram details. It returns an interpretation using ChatGPT.

    ```json
    {
        "question": "What should I focus on this month?",
        "iching_response": "Hexagram 23: Splitting Apart. Judgment: It does not further one to go anywhere. Lines: Six at the top..."
    }
    ```

### Example Request

To request an interpretation, use the following `curl` command:

```bash
curl -X POST "http://127.0.0.1:8000/interpret" -H "Content-Type: application/json" -d '{"question": "What should I focus on this month?", "iching_response": "Hexagram 23: Splitting Apart. Judgment: It does not further one to go anywhere."}'
```

### Example Response

The API will return a JSON response like this:

```json
{
    "interpretation": "The hexagram 'Splitting Apart' suggests a time of decline or decay. It's a period where things are falling apart, indicating that your focus should be on identifying and letting go of outdated practices or beliefs. Reflect inward and prepare for a renewal. This is not a time to start new ventures, but to carefully analyze the situation and adapt to the changes."
}
```

## Development

- Modify the `main.py` file to adjust API logic or add new endpoints.
- Use FastAPI's built-in documentation (`/docs` or `/redoc`) for easy testing and visualization of available endpoints.

### Langchain Configuration

- Ensure the `OPENAI_API_KEY` environment variable is set properly to use Langchain for ChatGPT integration.
- Modify the Langchain-related code if you need to adjust the prompt or interpretation behavior.

## Deployment

### Docker

1. **Build Docker Image**:
    ```bash
    docker build -t iching-interpreter .
    ```

2. **Run Docker Container**:
    ```bash
    docker run -d -p 8000:8000 -e OPENAI_API_KEY=your_openai_key iching-interpreter
    ```

### Cloud Deployment

- **Google Cloud Run**: Suitable for deploying the microservice as a scalable container.
- **AWS Lambda**: Can be adapted for serverless deployment with API Gateway.
- **Heroku**: Use Docker-based deployment for easy scaling and management.

## Contributing

1. Fork the repository.
2. Create a new branch (`git checkout -b feature-branch`).
3. Commit your changes (`git commit -am 'Add new feature'`).
4. Push to the branch (`git push origin feature-branch`).
5. Create a new Pull Request.

## License

This project is licensed under the MIT License - see the LICENSE file for details.

## Acknowledgments

- **I Ching Community**: For preserving the ancient wisdom that inspires this project.
- **OpenAI**: For providing the powerful language model that enables modern interpretations.
- **FastAPI**: For providing a robust framework to build high-performance APIs quickly and efficiently.
